# üìß Outlook Mail Fetcher via WinRM

A .NET application to fetch emails from a remote Outlook machine using **WinRM** and store them in a **SQL database**.  
The application monitors a `Mails.txt` file on the remote machine (generated by a PowerShell script) and automatically inserts new mails into a database.

---

## ‚öôÔ∏è Features
- Connects to a remote Windows machine via **WinRM**.
- Reads mails saved into `Mails.txt` by a PowerShell script running on Outlook machine.
- Detects **only new mails** (incremental reading).
- Supports **multi-line mail bodies**.
- Inserts mail data into a **SQL database**.
- Configurable via `appsettings.json`.

---

## üñ•Ô∏è Requirements
- .NET 6.0 SDK or later
- SQL Server (or Azure SQL Database)
- WinRM enabled on remote Outlook machine
- PowerShell script running on Outlook machine that writes mails to `Mails.txt`

---

## üöÄ Setup & Installation

1. **Clone repository**
   ```bash
   git clone https://github.com/your-org/outlook-mail-fetcher.git
   cd outlook-mail-fetcher

   


## 2. Install dependencies
  ```bash
   dotnet restore
   dotnet add package Microsoft.Data.SqlClient
   dotnet add package Microsoft.Extensions.Configuration
   dotnet add package Microsoft.Extensions.Configuration.Json

   
```
## 3. Configure database
   ```bash
   CREATE TABLE MailInbox (
   Id INT IDENTITY(1,1) PRIMARY KEY,
   ReceivedAt DATETIME,
   Sender NVARCHAR(255),
   Subject NVARCHAR(255),
   Body NVARCHAR(MAX)
   );


```
## 4. Edit appsettings.json
   ```bash
   {
  "WinRM": {
    "RemoteComputer": "192.168.1.34",
    "Username": "RemotePC\\user",
    "Password": "YourPassword",
    "RemoteFile": "C:\\MailFetcher\\Mails.txt",
    "IntervalSeconds": 10
  },
  "Database": {
    "ConnectionString": "Server=YOUR_SQL_SERVER;Database=MailDB;User Id=sa;Password=YourPassword;"
  }
}

```

## 5. Run application
```bash
   dotnet run

## PowerShell Script (Remote Outlook Machine)

The following script should run on the Outlook machine to export emails to Mails.txt:
There is Get-OutlookMails.ps1 name powershell script into this repo. you can copy this file to remote machine to export mails to txt file. or you can copy following script and run on remote machine where outlook is running.
```bash
# Get-OutlookMails.ps1
param(
    [string]$OutputFile = "C:\MailFetcher\Mails.txt",
    [int]$CheckInterval = 10
)

$Outlook = New-Object -ComObject Outlook.Application
$Namespace = $Outlook.GetNamespace("MAPI")
$Inbox = $Namespace.GetDefaultFolder([Microsoft.Office.Interop.Outlook.OlDefaultFolders]::olFolderInbox)

Write-Host "üìß Mail fetcher started. Saving to $OutputFile"

while ($true) {
    $messages = $Inbox.Items | Sort-Object ReceivedTime -Descending | Select-Object -First 5
    $output = ""

    foreach ($msg in $messages) {
        $output += "[{0}] From: {1}`r`nSubject: {2}`r`nBody: {3}`r`n`r`n" -f `
            (Get-Date $msg.ReceivedTime -Format "yyyy-MM-dd HH:mm"),
            $msg.SenderName,
            $msg.Subject,
            ($msg.Body -replace "`r`n"," ")
    }

    $output | Out-File $OutputFile -Encoding UTF8
    Start-Sleep -Seconds $CheckInterval
}




